# **一、 版本信息**

|  | 版本号 | 创建日期 | 创建人 | 备注 |
| :---- | :---- | :---- | :---- | :---- |
|  | V1.0.1 | 2025/09/06 | (产品经理) | 初版创建 |

# **二、 变更日志**

| 变更日期 | 版本号 | 变更内容 | 变更人 |
| :---- | :---- | :---- | :---- |
| 2025/09/06 | V1.0.1 | 初始文档撰写 | (产品经理) |
| 2025/09/06 | V1.0.1 | 补充产品实现方案 | (产品经理) |
| 2025/09/06 | V1.0.1 | 修改方案二名称 | (产品经理) |

# **三、 文档说明**

本文档旨在详细说明“对话式BPM Agent” V1.0（一期：智能报销）的产品需求。

## **3.1 名词解释**

| 术语 / 缩略词 | 说明 |
| :---- | :---- |
| **Agent** | 智能代理。在本文档中特指“对话式BPM Agent”产品，一个能理解用户意图并自动操作浏览器的AI助手。 |
| **BPM** | 业务流程管理 (Business Process Management)。泛指企业内部的审批流程系统（如OA、报销系统）。 |
| **OCR** | 光学字符识别 (Optical Character Recognition)。用于从发票图片或PDF中提取文字信息（如金额、项目）。 |
| **RPA** | 机器人流程自动化 (Robotic Process Automation)。本文档中指Agent操作浏览器自动登录、填单、提交的技术。 |
| **DOM** | 文档对象模型 (Document Object Model)。Agent分析网页结构以定位输入框、按钮的一种方式。 |
| **CV** | 计算机视觉 (Computer Vision)。AI Agent用于识别网页元素的辅助技术，提升定位的鲁棒性。 |
| **P0** | 优先级 (Priority 0)，最高优先级，产品核心功能，必须实现。 |
| **P1** | 优先级 (Priority 1)，高优先级，重要功能，应尽量实现。 |

# **四、 需求背景**

## **4.1 产品/数据现状（解决的问题）**

传统的BPM系统（如报销系统）操作界面复杂、字段繁多、流程僵化，导致：

1. **耗时耗力：** 员工需要花费大量时间手动填写表单、上传附件、核对信息。  
2. **容易出错：** 手动从发票转录信息到系统，容易出现金额、项目、日期填写错误。  
3. **体验不佳：** 繁琐的流程降低了员工满意度，占用了本可用于核心业务的时间。

## **4.2 用户调研（用户画像）**

* **姓名：** 张三  
* **角色：** 某公司销售经理  
* **痛点：** 经常出差，积压了大量发票（餐饮、交通、住宿）。每月报销时，需要打开公司的BPM系统，面对复杂的表单，逐张录入发票信息，并手动上传附件，整个过程至少需要1小时，且容易出错。  
* **期望：** “我希望能把这一堆发票直接‘扔’给系统，告诉它我要报销，它就能自动帮我搞定一切。”

# **五、 需求范围**

## **5.1 需求范围**

**产品愿景：** 打造一个智能、高效、零学习成本的企业流程自动化助手。员工可通过自然语言对话，自动完成复杂的企业系统操作（如报销、采购、请假等），极大提升运营效率，优化员工体验。

**一期核心功能（智能报销）：** 本产品是一个集成在企业IM（即时通讯）或独立窗口的对话机器人。在报销场景中，用户只需上传发票并下达指令，Agent即可自动完成发票识别、浏览器登录、表单填写、智能校验、流程提交等一系列操作。

## **5.2 主要需求点（用户与场景）**

**目标用户：** 企业内所有需要提交报销流程的员工（例如：销售、市场、研发、行政等）。

**核心用户场景（User Story）：** **场景：** 员工张三需要提交一笔包含多张发票的差旅报销。

1. **前置条件：** 张三已登录公司统一工作台，并打开“对话式Agent”窗口。  
2. **触发流程：**  
   * 张三将3张发票（2张PDF，1张JPG）拖拽上传到对话窗口。  
   * 张三输入：“帮我把这几张票报一下，事由是上海出差。”  
3. **AI处理（自动）：**  
   * **意图识别：** Agent识别到用户意图为“提交报销”。  
   * **附件OCR：** Agent自动调用OCR服务，识别3张发票的关键信息（金额、项目、日期、发票号等）。  
   * **浏览器自动化：** Agent在后台（或前台展示）启动浏览器，自动登录BPM系统，并导航至“费用报销”表单页面。  
   * **网页识别与填充：** Agent使用“智能网页识别”（DOM分析+CV）技术，定位表单中的字段（如：报销事由、费用明细、总金额）。  
   * **自动填充：**  
     * Agent将“上海出差”填入“报销事由”。  
     * Agent将OCR识别出的3条明细（项目、金额）逐一填入“费用明细”表格中。  
     * Agent自动计算总金额并填充。  
     * Agent将3张发票文件上传至BPM表单的“附件”区域。  
4. **对话式校验（关键）：**  
   * Agent在分析BPM表单时，发现“成本中心/科目”是一个必填项，但AI无法从发票或对话中获取。  
   * **Agent提问：** “张三您好，正在为您提交报销。系统检测到‘成本中心’尚未填写，请问这笔费用应归属哪个成本中心？（例如：A部门、B项目）”  
   * **用户回复：** “归属到B项目吧。”  
   * **AI处理：** Agent接收到回复，在浏览器中自动选择或填写“成本中心”为“B项目”。  
5. **流程提交与反馈：**  
   * Agent点击BPM系统中的“提交”按钮。  
   * Agent捕获到BPM系统返回的成功页面及“流程编号：BX-20251024-001”。  
   * **Agent反馈：** “您的‘上海出差’报销已成功提交！流程编号为：BX-20251024-001。您可以在BPM系统中跟踪后续审批进度。”  
6. **流程结束。**

# **六、 功能详细说明**

## **6.1 功能需求列表**

| 模块 | 功能点 | 优先级 | 详细描述 |
| :---- | :---- | :---- | :---- |
| **6.1.1 对话交互界面** | FR-1.1: 文件上传 | P0 | 对话窗口必须支持拖拽或点击上传文件，支持主流格式（.pdf, .jpg, .png, .jpeg）。 |
|  | FR-1.2: 文本交互 | P0 | 支持用户输入自然语言指令。 |
|  | FR-1.3: 状态反馈 | P0 | 必须实时展示Agent的状态，如“正在识别发票...”、“正在打开BPM系统...”、“请稍候...”。 |
| **6.1.2 AI核心能力** | FR-2.1: 意图识别 | P0 | 需准确识别用户“提交报销”的意图，并能从对话中提取上下文信息（如“上海出差”）。 |
|  | FR-2.2: 附件OCR | P0 | 自动对上传的发票附件进行OCR。需高精度识别关键字段：金额（合计）、项目（品名）、日期、发票类型、发票号码。 |
|  | FR-2.3: 网页内容识别 | P0 | 具备AI OCR或DOM+CV的网页识别能力。能准确定位BPM系统页面上的输入框、下拉框、按钮、附件上传控件等。要求对BPM系统的小幅改版具有鲁棒性。 |
| **6.1.3 浏览器自动化 (RPA)** | FR-3.1: 流程触发 | P0 | 接收到AI指令后，能自动启动浏览器（或控制现有浏览器插件）。 |
|  | FR-3.2: 系统登录 | P0 | 支持自动填充凭据或SSO单点登录，进入BPM系统。 |
|  | FR-3.3: 页面导航 | P0 | 能够根据预设（或AI动态规划）的路径，自动跳转到“发起报销”的具体页面。 |
|  | FR-3.4: 表单自动填充 | P0 | 核心功能。将OCR结果和用户信息，精确填入网页识别出的对应字段中。 |
|  | FR-3.5: 附件自动上传 | P0 | 将用户在对话框上传的附件，转存到BPM网页的附件上传控件中。 |
|  | FR-3.6: 动作执行 | P0 | 能够模拟点击“提交”、“保存”、“确认”等按钮。 |
| **6.1.4 智能校验与追问** | FR-4.1: 必填项校验 | P0 | 在提交前，Agent需能识别BPM表单中的必填项（如带有 \* 号的字段）。 |
|  | FR-4.2: 对话式追问 | P0 | 当检测到必填项为空（如“成本中心”），或OCR识别结果置信度低时，Agent必须暂停自动化流程，并在对话框中向用户发起询问。 |
|  | FR-4.3: 回复解析 | P0 | 能够理解用户对追问的回复（如“B项目”），并将该信息用于填充BPM表单。 |
| **6.1.5 结果反馈** | FR-5.1: 成功反馈 | P0 | 流程提交成功后，必须从网页捕获成功信息（如流程ID），并在对话框中反馈给用户。 |
|  | FR-5.2: 失败反馈 | P1 | 当BPM系统返回错误（如“金额超限”）或流程中断时，Agent需将错误信息清晰地转达给用户，并询问下一步操作。 |

## **6.2 智能报销流程图**

graph TD  
    subgraph "用户 (Employee)"  
        A\[开始\] \--\> B(打开对话Agent);  
        B \--\> C\[上传发票附件\];  
        C \--\> D{输入指令: "我要报销"};  
        D \--\> M{Agent询问: "缺少\[必填项\]"};  
        M \--\> N\[用户回复: "填写\[内容\]"\];  
        N \--\> P(Agent继续填充);  
        V\[查看成功反馈\] \--\> W\[结束\];  
    end

    subgraph "对话Agent (AI Core)"  
        D \--\> E\[1. 意图识别: 报销\];  
        E \--\> F\[2. 触发OCR服务\];  
        F \--\> G\[获取OCR结果: {金额, 项目...}\];  
        G \--\> H\[3. 触发浏览器自动化\];  
        H \--\> K(网页识别: 定位字段);  
        K \--\> L\[4. 自动填充表单\];  
        L \--\> O{5. 校验: 是否有必填项为空?};  
        O \-- 否 \--\> Q\[6. 模拟点击"提交"\];  
        O \-- 是 \--\> M;  
        P \--\> Q;  
        Q \--\> T\[7. 捕获BPM返回结果\];  
        T \-- 成功 \--\> U\[反馈: "提交成功, 流程ID: XXX"\];  
        T \-- 失败 \--\> U\_Error\[反馈: "提交失败, 原因: XXX"\];  
        U \--\> V;  
        U\_Error \--\> V;  
    end

    subgraph "OCR服务 (OCR Service)"  
        F \--\> F\_1(识别发票内容);  
        F\_1 \--\> G;  
    end

    subgraph "BPM系统 (Browser Automation)"  
        H \--\> I\[打开BPM登录页\];  
        I \--\> J\[登录并导航至报销表单\];  
        J \--\> K;  
        L \--\> L\_BPM(BPM表单被填充);  
        P \--\> P\_BPM(BPM表单补充填充);  
        Q \--\> R(BPM系统处理提交);  
        R \--\> S\[返回: "提交成功"或"错误信息"\];  
        S \--\> T;  
    end

# **七、 产品实现方案**

针对本产品的实现，探讨以下两种主要技术路径：

## **7.1 方案一：浏览器插件（非侵入式）**

* **实现方式：** 开发一个浏览器插件（如Chrome/Edge Extension）。  
* **工作流程：** 当用户在浏览器中打开目标BPM系统网页时，插件被激活并自动加载。  
* **交互界面：** 插件在BPM页面侧边或角落注入一个对话窗口（UI）。  
* **操作逻辑：** 用户在插件的对话窗口中下达指令（如上传发票、输入'报销'）。插件的后台脚本（Content Script）可以直接读取和操作当前BPM页面的DOM，实现表单填充、附件上传和按钮点击。  
* **优点：** 非侵入式，用户在自己熟悉的主窗口操作，体验流畅。  
* **缺点：** 需要为不同BPM系统做页面适配，且受浏览器插件安全策略限制。

## **7.2 方案二：Browser Use模式**

* **实现方式：** Agent以一个独立的客户端应用（或后台服务）形态存在。  
* **工作流程：** 当用户在对话框（可以是桌面应用或IM工具）中下达指令后，Agent启动一个*新的*、受控的浏览器实例（例如通过Selenium, Playwright或Puppeteer）。  
* **交互界面：** 这个新打开的浏览器窗口对用户可见。用户可以观察到Agent正在自动执行登录、填表、点击等操作。  
* **操作逻辑：** Agent通过RPA/浏览器自动化技术栈与这个新窗口进行通信和控制。  
* **优点：** 自动化控制力强，可实现跨应用操作（不止是浏览器），对目标BPM系统无侵入。  
* **缺点：** 操作在*新*窗口中进行，可能会轻微割裂用户在主工作区的体验（需要观看另一个窗口）。

# **八、 非功能需求**

| 类别 | 需求描述 |
| :---- | :---- |
| **8.1 性能与准确性** | OCR识别： 单张发票识别时间 \< 5秒。 端到端流程： 从用户下达指令到提交成功（不含用户确认时间），整个自动化流程应 \< 1分钟。 意图识别准确率： \> 98%。 OCR关键字段准确率： 金额、日期识别准确率 \> 99.5%。 网页字段定位准确率： \> 99%。 |
| **8.2 安全需求** | 发票附件、OCR结果、BPM凭据等敏感信息在传输和存储时必须全程加密。处理完成后应及时清理临时文件。 |
| **8.3 兼容性需求** | 浏览器： 必须支持主流浏览器（Chrome, Edge）。 BPM系统： 一期需完美适配公司当前的BPM系统（如：泛微、致远、金蝶云等）。 |
| **8.4 鲁棒性** | 当BPM系统页面UI发生轻微变化（如按钮位置移动、颜色改变）时，网页识别模型应能自适应，不中断流程。 |

# **九、 埋点**

| 页面/模块 | 事件ID | 事件名称 | 触发时机 | 备注参数 |
| :---- | :---- | :---- | :---- | :---- |
| 对话窗口 | event\_001 | 启动Agent | 打开对话窗口时 | user\_id |
| 对话窗口 | event\_002 | 上传附件 | 用户成功上传文件 | file\_count, file\_type |
| AI Agent | event\_003 | 触发流程 | 意图识别成功 (如"报销") | intent\_name |
| AI Agent | event\_004 | OCR成功 | OCR服务成功返回 | ocr\_time\_ms, invoice\_count |
| AI Agent | event\_005 | 追问发起 | Agent向用户发起追问 | question\_type (e.g., 'missing\_field') |
| AI Agent | event\_006 | 流程提交成功 | BPM系统返回成功 | flow\_id, total\_duration\_ms |
| AI Agent | event\_007 | 流程失败 | Agent或BPM报错 | error\_message, error\_stage |

# **十、 项目规划（Roadmap）**

* **二期（流程扩展）：** 支持更多高频BPM流程，如：请假申请、采购申请、合同审批。  
* **三期（主动服务）：** Agent根据日历、差旅信息，主动询问用户“您是否需要提交XX项目的报销？”  
* **四期（流程挖掘）：** AI通过观察用户操作，反向学习并自动生成新的自动化流程。